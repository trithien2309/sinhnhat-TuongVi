<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M·ª´ng Sinh Nh·∫≠t Ng∆∞·ªùi Y√™u</title>
    <!-- Li√™n k·∫øt t·ªõi file CSS b√™n ngo√†i -->
    <link rel="stylesheet" href="style.css">
    <!-- Th√™m th∆∞ vi·ªán canvas-confetti t·ª´ CDN -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
</head>
<body>
    <!-- N·ªÅn √°nh s√°ng nh·∫•p nh√°y -->
    <div class="background-lights"></div>
    <!-- N·ªÅn tr√°i tim bay l√™n -->
    <div class="floating-hearts" id="floatingHearts"></div>

    <h1>Ch√∫c M·ª´ng Sinh Nh·∫≠t, T∆∞·ªùng Vy!</h1>
    <p>Ch√∫c em c√≥ m·ªôt ng√†y sinh nh·∫≠t th·∫≠t tuy·ªát v·ªùi, ƒë·∫ßy ·∫Øp ni·ªÅm vui v√† y√™u th∆∞∆°ng!</p>
    <div class="heart" id="heart">‚ù§Ô∏è</div>

    <!-- Modal Structure -->
    <div id="loveModal" class="modal">
        <div class="modal-content">
            <p>Em c√≥ th·ªÉ l√†m ng∆∞·ªùi y√™u anh kh√¥ng?</p>
            <div class="modal-buttons">
                <button class="btn-yes" id="btnYes">ƒê·ªìng √Ω</button>
                <button class="btn-no" id="btnNo">Kh√¥ng</button>
            </div>
        </div>
    </div>

    <!-- Thank You Modal -->
    <div id="thankYouModal" class="modal">
        <div class="modal-content">
            <p>C·∫£m ∆°n em ƒë√£ ƒë·∫øn b√™n anh! T·ª´ gi√¢y ph√∫t n√†y ƒë√¢y anh s·∫Ω y√™u em b·∫±ng t·∫•t c·∫£ nh·ªØng g√¨ anh c√≥ ‚ù§Ô∏è</p>
            <!-- ƒê·ªìng h·ªì ƒë·∫øm th·ªùi gian -->
            <div id="clock" class="clock">
                <span id="days">0</span> ng√†y 
                <span id="hours">00</span> gi·ªù 
                <span id="minutes">00</span> ph√∫t 
                <span id="seconds">00</span> gi√¢y
            </div>
            <div class="modal-buttons">
                <button class="btn-close" id="btnClose">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- √Çm Thanh N·ªÅn -->
    <audio id="backgroundMusic" src="https://www.bensound.com/bensound-music/bensound-love.mp3" preload="auto" loop></audio>

    <script>
        // L·∫•y c√°c ph·∫ßn t·ª≠ modal
        const loveModal = document.getElementById('loveModal');
        const thankYouModal = document.getElementById('thankYouModal');

        // L·∫•y n√∫t m·ªü modal
        const heart = document.getElementById('heart');

        // L·∫•y c√°c n√∫t trong modal
        const btnYes = document.getElementById('btnYes');
        const btnNo = document.getElementById('btnNo');
        const btnClose = document.getElementById('btnClose');

        // L·∫•y √¢m thanh n·ªÅn
        const backgroundMusic = document.getElementById('backgroundMusic');

        // L·∫•y ph·∫ßn t·ª≠ ch·ª©a tr√°i tim bay l√™n
        const floatingHearts = document.getElementById('floatingHearts');

        // L·∫•y ƒë·ªìng h·ªì ƒë·∫øm th·ªùi gian
        const clock = document.getElementById('clock');

        // Bi·∫øn ƒë·ªÉ qu·∫£n l√Ω ƒë·ªìng h·ªì ƒë·∫øm th·ªùi gian
        let clockInterval;
        let totalSeconds = 0;

        // Bi·∫øn tr·∫°ng th√°i ƒë·ªÉ bi·∫øt ng∆∞·ªùi d√πng ƒë√£ ƒë·ªìng √Ω ch∆∞a
        let hasAgreed = false;

        // H√†m ƒë·ªÉ kh·ªüi ƒë·ªông ƒë·ªìng h·ªì ƒë·∫øm th·ªùi gian t·ª´ m·ªôt th·ªùi ƒëi·ªÉm b·∫Øt ƒë·∫ßu
        function startClock(startTime) {
            clock.style.display = "block"; // Hi·ªÉn th·ªã ƒë·ªìng h·ªì
            updateClock(startTime); // C·∫≠p nh·∫≠t ngay l·∫≠p t·ª©c
            clockInterval = setInterval(() => {
                updateClock(startTime);
            }, 1000);
        }

        // H√†m ƒë·ªÉ c·∫≠p nh·∫≠t ƒë·ªìng h·ªì
        function updateClock(startTime) {
            const now = Date.now();
            const elapsedSeconds = Math.floor((now - startTime) / 1000);
            const days = Math.floor(elapsedSeconds / (3600 * 24));
            const hours = Math.floor((elapsedSeconds % (3600 * 24)) / 3600);
            const minutes = Math.floor((elapsedSeconds % 3600) / 60);
            const seconds = elapsedSeconds % 60;

            document.getElementById('days').textContent = days;
            document.getElementById('hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
        }

        // H√†m ƒë·ªÉ d·ª´ng ƒë·ªìng h·ªì ƒë·∫øm th·ªùi gian
        function stopClock() {
            clearInterval(clockInterval);
            clock.style.display = "none"; // ·∫®n ƒë·ªìng h·ªì
        }

        // Ki·ªÉm tra tr·∫°ng th√°i khi trang ƒë∆∞·ª£c t·∫£i
        window.addEventListener('load', () => {
            const agreedTime = localStorage.getItem('agreedTime');
            if (agreedTime) {
                hasAgreed = true;
                thankYouModal.style.display = "block";
                launchConfetti(); // K√≠ch ho·∫°t hi·ªáu ·ª©ng ph√°o hoa
                createMoreConfetti(); // Th√™m ph√°o hoa nhi·ªÅu h∆°n
                startClock(parseInt(agreedTime));
            }

            // C·ªë g·∫Øng ph√°t nh·∫°c n·ªÅn
            backgroundMusic.play().then(() => {
                console.log('Nh·∫°c n·ªÅn ƒëang ph√°t.');
            }).catch(error => {
                console.log('Autoplay b·ªã ch·∫∑n b·ªüi tr√¨nh duy·ªát.', error);
            });
        });

        // Khi ng∆∞·ªùi d√πng nh·∫•n v√†o tr√°i tim, m·ªü modal y√™u c·∫ßu ho·∫∑c thank you modal t√πy v√†o tr·∫°ng th√°i
        heart.onclick = function() {
            if (!hasAgreed) {
                // N·∫øu ch∆∞a ƒë·ªìng √Ω, m·ªü modal y√™u c·∫ßu
                loveModal.style.display = "block";
                createFloatingHearts(); // T·∫°o tr√°i tim bay l√™n n·ªÅn

                // Ki·ªÉm tra n·∫øu nh·∫°c ch∆∞a ƒë∆∞·ª£c ph√°t, c·ªë g·∫Øng ph√°t nh·∫°c
                if (backgroundMusic.paused) {
                    backgroundMusic.play().catch(error => {
                        console.log('Kh√¥ng th·ªÉ ph√°t nh·∫°c:', error);
                    });
                }
            } else {
                // N·∫øu ƒë√£ ƒë·ªìng √Ω, m·ªü thank you modal v√† hi·ªÉn th·ªã ƒë·ªìng h·ªì
                thankYouModal.style.display = "block";
                launchConfetti(); // K√≠ch ho·∫°t hi·ªáu ·ª©ng ph√°o hoa
                createMoreConfetti(); // Th√™m ph√°o hoa nhi·ªÅu h∆°n
                const agreedTime = parseInt(localStorage.getItem('agreedTime'));
                if (agreedTime) {
                    startClock(agreedTime);
                }
            }
        }

        // Khi ng∆∞·ªùi d√πng nh·∫•n "ƒê·ªìng √Ω"
        btnYes.onclick = function() {
            hasAgreed = true; // ƒê√°nh d·∫•u ƒë√£ ƒë·ªìng √Ω
            loveModal.style.display = "none";
            thankYouModal.style.display = "block";
            launchConfetti(); // K√≠ch ho·∫°t hi·ªáu ·ª©ng ph√°o hoa
            createMoreConfetti(); // Th√™m ph√°o hoa nhi·ªÅu h∆°n
            const agreedTime = Date.now();
            localStorage.setItem('agreedTime', agreedTime);
            startClock(agreedTime); // B·∫Øt ƒë·∫ßu ƒë·ªìng h·ªì ƒë·∫øm th·ªùi gian t·ª´ th·ªùi ƒëi·ªÉm ƒë·ªìng √Ω
        }

        // Khi ng∆∞·ªùi d√πng nh·∫•n "Kh√¥ng"
        btnNo.onclick = function() {
            loveModal.style.display = "none";
            alert("H√£y suy nghƒ© l·∫°i nh√©! üò¢");
            loveModal.style.display = "block";
        }

        // Khi ng∆∞·ªùi d√πng nh·∫•n "ƒê√≥ng" trong modal c·∫£m ∆°n
        btnClose.onclick = function() {
            thankYouModal.style.display = "none";
            stopClock(); // D·ª´ng ƒë·ªìng h·ªì ƒë·∫øm th·ªùi gian
        }

        // Khi ng∆∞·ªùi d√πng nh·∫•n ngo√†i modal, ƒë√≥ng modal
        window.onclick = function(event) {
            if (event.target == loveModal) {
                loveModal.style.display = "none";
            }
            if (event.target == thankYouModal) {
                thankYouModal.style.display = "none";
                stopClock(); // D·ª´ng ƒë·ªìng h·ªì n·∫øu ƒë√≥ng b·∫±ng c√°ch nh·∫•n ngo√†i
            }
        }

        // H√†m ƒë·ªÉ k√≠ch ho·∫°t hi·ªáu ·ª©ng ph√°o hoa
        function launchConfetti() {
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#FF69B4', '#FFB6C1', '#FFC0CB', '#FF1493']
            });
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#4682B4', '#5A9BD5', '#6495ED', '#1E90FF']
            });
        }

        // H√†m ƒë·ªÉ t·∫°o th√™m ph√°o hoa
        function createMoreConfetti() {
            setInterval(() => {
                confetti({
                    particleCount: 100,
                    spread: 60,
                    origin: { y: 0.6 },
                    colors: ['#FF69B4', '#FFB6C1', '#FFC0CB', '#FF1493']
                });
            }, 1000);
        }

        // H√†m ƒë·ªÉ t·∫°o tr√°i tim bay l√™n n·ªÅn
        function createFloatingHearts() {
            const heartCount = 20;
            for(let i = 0; i < heartCount; i++) {
                const heart = document.createElement('div');
                heart.classList.add('heart');
                heart.style.left = Math.random() * 100 + 'vw';
                heart.style.animationDuration = 5 + Math.random() * 5 + 's';
                heart.style.fontSize = (10 + Math.random() * 20) + 'px';
                heart.innerHTML = '‚ù§Ô∏è';
                floatingHearts.appendChild(heart);
            }
        }
    </script>
</body>
</html>
